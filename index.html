<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CLX Finance V1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.15/index.global.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.15/index.global.min.css">

  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <aside class="sidebar">
    <div id="backdrop" class="backdrop"></div>
    <div class="brand">
      <div class="brand-dot"></div>
      <span>CLX Finance</span>
    </div>
    <nav>
      <button class="nav-link active" data-target="dashboard">Dashboard</button>
      <button class="nav-link" data-target="incomes">Einnahmen</button>
      <button class="nav-link" data-target="expenses">Ausgaben</button>
      <button class="nav-link" data-target="projects">Projekte</button>
      <button class="nav-link" data-target="clients">Kunden</button>
      <button class="nav-link" data-target="documents">Dokumente</button>
    </nav>
    <div class="env-hint">
      <div>⚙️ <strong>Supabase</strong></div>
      <small>Öffne <code>supabase.js</code> und trage <em>SUPABASE_URL</em> & <em>ANON_KEY</em> ein.</small>
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <button id="menuToggle" class="btn btn-ghost">☰</button>
      <h1 id="page-title">Dashboard</h1>
      <div class="spacer"></div>
      <button id="refreshBtn" class="btn">Aktualisieren</button>
    </header>

    <!-- DASHBOARD -->
    <section id="dashboard" class="view active">
      <div class="grid-3">
        <div class="card kpi">
          <div class="kpi-label">Monat Einnahmen</div>
          <div class="kpi-value" id="kpi-month-income">–</div>
        </div>
        <div class="card kpi">
          <div class="kpi-label">Monat Ausgaben</div>
          <div class="kpi-value" id="kpi-month-expenses">–</div>
        </div>
        <div class="card kpi">
          <div class="kpi-label">Monat Gewinn</div>
          <div class="kpi-value" id="kpi-month-profit">–</div>
        </div>
      </div>

      <div class="grid-2" style="margin-top:12px">
  <div class="card kpi">
    <div class="kpi-label">Jahr Umsatz</div>
    <div class="kpi-value" id="kpi-year-income">–</div>
  </div>
  <div class="card kpi">
    <div class="kpi-label">Jahr Gewinn</div>
    <div class="kpi-value" id="kpi-year-profit">–</div>
  </div>
</div>


      <div class="grid-2">
        <div class="card">
          <div class="card-title">Jahresverlauf</div>
          <canvas id="incomeExpenseChart"></canvas>
        </div>
        <div class="card">
          <div class="card-title">Kalender</div>
          <div id="calendar"></div>
        </div>
      </div>
    </section>

    <!-- EINNAHMEN -->
    <section id="incomes" class="view">
      <div class="card">
        <div class="card-title">Neue Einnahme</div>
        <form id="income-form" class="form-grid">
          <label>Datum<input type="date" name="tx_date" required></label>
          <label>Projekt<select name="project_id" id="income-project"></select></label>
          <label>Kunde<select name="client_id" id="income-client"></select></label>
          <label>Kategorie<select name="category_id" id="income-category" required></select></label>
          <label>Betrag (CHF)<input type="number" step="0.01" min="0" name="amount_chf" required></label>
          <label>Status
            <select name="status">
              <option value="paid">bezahlt</option>
              <option value="open">offen</option>
              <option value="overdue">überfällig</option>
              <option value="cancelled">storniert</option>
            </select>
          </label>
          <label class="col-span-2">Beschreibung<textarea name="description" rows="2"></textarea></label>
          <div class="actions col-span-2">
            <button type="submit" class="btn">Speichern</button>
            <button type="reset" class="btn btn-ghost">Zurücksetzen</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Einnahmen</div>
        <table class="table" id="income-table">
          <thead><tr>
            <th>Datum</th><th>Projekt</th><th>Kunde</th><th>Kategorie</th><th class="num">CHF</th><th>Status</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- AUSGABEN -->
    <section id="expenses" class="view">
      <div class="card">
        <div class="card-title">Neue Ausgabe</div>
        <form id="expense-form" class="form-grid">
          <label>Datum<input type="date" name="tx_date" required></label>
          <label>Projekt<select name="project_id" id="expense-project"></select></label>
          <label>Lieferant<input type="text" name="vendor" placeholder="z.B. Digitec"></label>
          <label>Kategorie<select name="category_id" id="expense-category" required></select></label>
          <label>Betrag (CHF)<input type="number" step="0.01" min="0" name="amount_chf" required></label>
          <label class="col-span-2">Beschreibung<textarea name="description" rows="2"></textarea></label>
          <div class="actions col-span-2">
            <button type="submit" class="btn">Speichern</button>
            <button type="reset" class="btn btn-ghost">Zurücksetzen</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Ausgaben</div>
        <table class="table" id="expense-table">
          <thead><tr>
            <th>Datum</th><th>Projekt</th><th>Lieferant</th><th>Kategorie</th><th class="num">CHF</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- PROJEKTE -->
    <section id="projects" class="view">
      <div class="card">
        <div class="card-title">Neues Projekt</div>
        <form id="project-form" class="form-grid">
          <label>Projektname<input type="text" name="name" required></label>
          <label>Kunde<select name="client_id" id="project-client"></select></label>
          <label>Start<input type="date" name="start_date"></label>
          <label>Ende<input type="date" name="end_date"></label>
          <label>Status
            <select name="status">
              <option value="planned">geplant</option>
              <option value="in_progress">laufend</option>
              <option value="completed">abgeschlossen</option>
              <option value="cancelled">storniert</option>
            </select>
          </label>
          <label>Budget (CHF)<input type="number" step="0.01" min="0" name="budget_chf"></label>
          <label class="col-span-2">Notizen<textarea name="notes" rows="2"></textarea></label>
          <div class="actions col-span-2">
            <button type="submit" class="btn">Speichern</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Projekte</div>
        <table class="table" id="project-table">
          <thead><tr>
            <th>Projekt</th><th>Kunde</th><th>Status</th><th class="num">Einnahmen</th><th class="num">Ausgaben</th><th class="num">Gewinn</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- KUNDEN -->
    <section id="clients" class="view">
      <div class="card">
        <div class="card-title">Neuer Kunde</div>
        <form id="client-form" class="form-grid">
          <label>Name<input type="text" name="name" required></label>
          <label>E-Mail<input type="email" name="email"></label>
          <label>Telefon<input type="text" name="phone"></label>
          <label class="col-span-2">Adresse<textarea name="billing_address" rows="2"></textarea></label>
          <label>MWST-Nr.<input type="text" name="vat_number"></label>
          <div class="actions col-span-2">
            <button type="submit" class="btn">Speichern</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Kunden</div>
        <table class="table" id="client-table">
          <thead><tr>
            <th>Name</th><th>E-Mail</th><th>Telefon</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- DOKUMENTE -->
    <section id="documents" class="view">
      <div class="card">
        <div class="card-title">Dokument erstellen (Offerte / Rechnung)</div>
        <form id="document-form" class="form-grid">
          <label>Typ
            <select name="doc_type">
              <option value="quote">Offerte</option>
              <option value="invoice">Rechnung</option>
            </select>
          </label>
          <label>Kunde<select name="client_id" id="doc-client" required></select></label>
          <label>Projekt<select name="project_id" id="doc-project"></select></label>
          <label>Ausstellungsdatum<input type="date" name="issue_date" required></label>
          <label>Fällig am<input type="date" name="due_date"></label>
          <label>MWST %<input type="number" step="0.01" min="0" name="tax_rate" value="0"></label>
          <label class="col-span-2">Notizen<textarea name="notes" rows="2"></textarea></label>

          <div class="col-span-2">
            <table class="table tight" id="doc-items">
              <thead><tr><th>Beschreibung</th><th class="num">Menge</th><th class="num">Einzelpreis</th><th class="num">Total</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
            <button type="button" class="btn btn-ghost" id="add-item">+ Position</button>
          </div>

          <div class="totals col-span-2">
            <div>Zwischensumme: <span id="doc-subtotal">0.00</span> CHF</div>
            <div>MWST: <span id="doc-tax">0.00</span> CHF</div>
            <div class="sum">Total: <span id="doc-total">0.00</span> CHF</div>
          </div>

          <div class="actions col-span-2">
            <button type="submit" class="btn">Dokument speichern</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Letzte Dokumente</div>
        <table class="table" id="document-table">
          <thead><tr>
            <th>Nr.</th><th>Typ</th><th>Kunde</th><th>Projekt</th><th>Status</th><th class="num">Total</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <div id="toast" class="toast"></div>
  </main>

  <!-- Vendor libs -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.15/index.global.min.js"></script>

  <!-- App -->
  <script type="module" src="./supabase.js"></script>
  <script type="module" src="./app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.15/index.global.min.js"></script>

</body>
</html>
